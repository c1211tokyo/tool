<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è˜‡çš„å·¥å…·ç®± â€” è´·æ¬¾è®¡ç®—å™¨</title>
  <style>
    :root{--bg:#0b0b0d;--card:#15151a;--muted:#b0b8c4;--accent:#7dd3fc;--text:#f0f4f8;--border:rgba(255,255,255,0.08)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,'Helvetica Neue',Arial;background:var(--bg);color:var(--text)}
    header{padding:28px 20px;text-align:center}
    h1{margin:0;font-size:1.5rem;letter-spacing:1px;color:#fff}
    main{max-width:1000px;margin:20px auto;padding:20px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border:1px solid var(--border);padding:18px;border-radius:12px}
    h2,h3{color:#fff;font-weight:600}
    label{display:block;font-size:0.85rem;color:var(--muted);margin-bottom:6px;font-weight:500}
    input,select{width:100%;padding:12px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,0.04);color:var(--text);font-size:0.95rem;transition:border-color .2s}
    input:focus,select:focus{outline:none;border-color:var(--accent)}
    input::placeholder{color:rgba(255,255,255,0.3)}
    select option{background:#1a1a22;color:var(--text)}
    .row{display:flex;gap:12px}
    .row > *{flex:1}
    .btn{display:inline-block;padding:12px 16px;border-radius:10px;background:rgba(255,255,255,0.05);border:1px solid var(--border);cursor:pointer;color:var(--text);font-size:0.9rem;transition:all .2s}
    .btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(125,211,252,0.3)}
    .btn.primary{background:linear-gradient(90deg,#0ea5e9,#38bdf8);color:#071126;border:none;font-weight:600}
    .btn.primary:hover{filter:brightness(1.1)}
    .result{font-size:0.95rem;margin-top:14px;padding:14px;border-radius:10px;background:rgba(125,211,252,0.08);border:1px solid rgba(125,211,252,0.15);color:var(--text);line-height:1.7}
    .result strong{color:var(--accent)}
    table{width:100%;border-collapse:collapse;font-size:0.85rem;margin-top:12px}
    th,td{padding:10px 8px;text-align:right;border-bottom:1px solid var(--border)}
    th{color:var(--muted);text-align:center;font-weight:600;background:rgba(255,255,255,0.02)}
    td{color:var(--text)}
    tbody tr:hover{background:rgba(125,211,252,0.05)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    footer{padding:20px;text-align:center;color:var(--muted);font-size:0.85rem}
    ul{color:var(--muted);line-height:1.8}
    ul li{margin-bottom:6px}
    @media(max-width:880px){.grid{grid-template-columns:1fr}.row{flex-direction:column}}
  </style>
</head>
<body>
  <header>
    <h1>è˜‡çš„å·¥å…·ç®± â€” è´·æ¬¾è®¡ç®—å™¨</h1>
    <div style="color:var(--muted);margin-top:8px">æ”¯æŒä¸­å›½ & æ—¥æœ¬çš„å¸¸è§è¿˜æ¬¾æ–¹å¼ï¼Œç”Ÿæˆæ‘Šè¿˜è¡¨å¹¶å¯¼å‡º CSV</div>
  </header>
  <main>
    <div class="grid">
      <section class="card">
        <h2 style="margin-top:0">è´·æ¬¾å‚æ•°</h2>
        <div style="margin-top:10px">
          <label>é€‚ç”¨åœ°åŒº</label>
          <select id="country">
            <option value="cn">ä¸­å›½ (CNY)</option>
            <option value="jp">æ—¥æœ¬ (JPY)</option>
          </select>
        </div>
        <div style="margin-top:12px">
          <label>è´·æ¬¾é‡‘é¢</label>
          <input id="principal" type="text" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š3,000,000" />
        </div>
        <div style="margin-top:12px" class="row">
          <div>
            <label>å¹´åˆ©ç‡ï¼ˆ%ï¼‰</label>
            <input id="rate" type="number" step="0.001" placeholder="ä¾‹ï¼š3.25" />
          </div>
          <div>
            <label>åˆ©ç‡ç±»å‹</label>
            <select id="rateType">
              <option value="fixed">å›ºå®šåˆ©ç‡</option>
              <option value="variable">æµ®åŠ¨åˆ©ç‡ï¼ˆä»…ä¼°ç®—ï¼‰</option>
            </select>
          </div>
        </div>
        <div style="margin-top:12px" class="row">
          <div>
            <label>è´·æ¬¾æœŸé™ï¼ˆå¹´ï¼‰</label>
            <input id="term" type="number" min="1" step="1" placeholder="ä¾‹ï¼š30" />
          </div>
          <div>
            <label>è¿˜æ¬¾é¢‘ç‡</label>
            <select id="frequency">
              <option value="12">æŒ‰æœˆè¿˜æ¬¾</option>
              <option value="4">æŒ‰å­£è¿˜æ¬¾</option>
              <option value="1">æŒ‰å¹´è¿˜æ¬¾</option>
            </select>
          </div>
        </div>
        <div style="margin-top:12px">
          <label>è¿˜æ¬¾æ–¹å¼</label>
          <select id="method">
            <option value="annuity">ç­‰é¢æœ¬æ¯ï¼ˆæ¯æœŸç­‰é¢ï¼‰</option>
            <option value="equal-principal">ç­‰é¢æœ¬é‡‘ï¼ˆæœ¬é‡‘ç›¸ç­‰ï¼Œåˆ©æ¯é€’å‡ï¼‰</option>
            <option value="interest-only">å…ˆæ¯åæœ¬ï¼ˆåˆ°æœŸå¿è¿˜æœ¬é‡‘ï¼‰</option>
            <option value="bullet">åˆ°æœŸä¸€æ¬¡è¿˜æœ¬ä»˜æ¯</option>
          </select>
        </div>
        <div style="margin-top:16px" class="row">
          <button class="btn primary" id="calc">è®¡ç®—å¹¶ç”Ÿæˆæ‘Šè¿˜è¡¨</button>
          <button class="btn" id="reset">é‡ç½®</button>
        </div>
        <div class="result" id="summary">è¾“å…¥è´·æ¬¾å‚æ•°åç‚¹å‡»ã€Œè®¡ç®—å¹¶ç”Ÿæˆæ‘Šè¿˜è¡¨ã€æŸ¥çœ‹ç»“æœã€‚</div>
        <div class="actions">
          <button class="btn" id="exportCsv">ğŸ“¥ å¯¼å‡º CSV</button>
          <button class="btn" id="copySchedule">ğŸ“‹ å¤åˆ¶æ‘Šè¿˜è¡¨</button>
        </div>
      </section>
      <aside class="card" id="rightPanel">
        <h3 style="margin-top:0">æ‘Šè¿˜è¡¨é¢„è§ˆ</h3>
        <div id="tableWrap" style="max-height:520px;overflow:auto">
          <table id="scheduleTable">
            <thead>
              <tr><th>æœŸæ•°</th><th>æœŸåˆä½™é¢</th><th>æœ¬é‡‘</th><th>åˆ©æ¯</th><th>å½“æœŸè¿˜æ¬¾</th><th>æœŸæœ«ä½™é¢</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </aside>
    </div>
    <section class="card" style="margin-top:20px">
      <h3 style="margin-top:0">è¯´æ˜ä¸æç¤º</h3>
      <ul>
        <li>æœ¬å·¥å…·æä¾›å¸¸è§è¿˜æ¬¾æ–¹å¼è®¡ç®—ä¸æ‘Šè¿˜è¡¨å¯¼å‡ºï¼Œä¾¿äºå¯¹æ¯”ä¸åŒæ–¹æ¡ˆã€‚</li>
        <li>æµ®åŠ¨åˆ©ç‡ä»…ä½œä¼°ç®—ï¼Œå®é™…åˆ©ç‡ä»¥é“¶è¡ŒåˆåŒä¸ºå‡†ã€‚</li>
        <li>ä¸­å›½å¸¸è§ï¼šç­‰é¢æœ¬æ¯ã€ç­‰é¢æœ¬é‡‘ï¼›æ—¥æœ¬å¸¸è§ï¼šç­‰é¢æœ¬é‡‘ã€‚</li>
        <li>å¦‚éœ€å…¬ç§¯é‡‘è´·æ¬¾ã€ç»„åˆè´·æ¬¾ã€æå‰è¿˜æ¬¾æ¨¡æ‹Ÿç­‰åŠŸèƒ½ï¼Œè¯·å‘ŠçŸ¥ã€‚</li>
      </ul>
    </section>
  </main>
  <footer>è˜‡çš„å·¥å…·ç®± Â· è´·æ¬¾è®¡ç®—å™¨ SUYU.202511</footer>
  <script>
    function fmt(num,currency){
      if(!isFinite(num))return"-";
      const d=currency==='JPY'?0:2;
      return new Intl.NumberFormat('zh-CN',{minimumFractionDigits:d,maximumFractionDigits:d}).format(num);
    }
    function parseNum(str){return parseFloat(str.replace(/,/g,''))||0;}
    function formatInput(el){
      const v=el.value.replace(/[^\d.]/g,'');
      const n=parseFloat(v);
      if(!isNaN(n)&&v!==''){
        const parts=v.split('.');
        const int=parseInt(parts[0]).toLocaleString('zh-CN');
        el.value=parts.length>1?int+'.'+parts[1]:int;
      }else if(v===''){el.value='';}
    }
    document.getElementById('principal').addEventListener('input',function(){formatInput(this);});
    function clearTable(){document.querySelector('#scheduleTable tbody').innerHTML='';}
    function addRow(i,begin,principal,interest,payment,end,currency){
      const tr=document.createElement('tr');
      tr.innerHTML=`<td style="text-align:center">${i}</td><td>${fmt(begin,currency)}</td><td>${fmt(principal,currency)}</td><td>${fmt(interest,currency)}</td><td>${fmt(payment,currency)}</td><td>${fmt(end,currency)}</td>`;
      document.querySelector('#scheduleTable tbody').appendChild(tr);
    }
    function generateSchedule({principal,annualRate,years,freq,method}){
      const periods=years*freq,periodRate=annualRate/100/freq;
      let schedule=[],balance=principal;
      if(method==='annuity'){
        const r=periodRate;
        let pmt=r===0?principal/periods:principal*r*Math.pow(1+r,periods)/(Math.pow(1+r,periods)-1);
        for(let i=1;i<=periods;i++){
          const int=balance*r;
          let princ=pmt-int;
          if(i===periods)princ=balance;
          const end=Math.max(0,balance-princ);
          schedule.push({i,begin:balance,principal:princ,interest:int,payment:princ+int,end});
          balance=end;
        }
      }else if(method==='equal-principal'){
        const pe=principal/periods;
        for(let i=1;i<=periods;i++){
          const int=balance*periodRate,pmt=pe+int,end=Math.max(0,balance-pe);
          schedule.push({i,begin:balance,principal:pe,interest:int,payment:pmt,end});
          balance=end;
        }
      }else if(method==='interest-only'){
        for(let i=1;i<=periods;i++){
          const int=principal*periodRate;
          schedule.push({i,begin:principal,principal:0,interest:int,payment:int,end:principal});
        }
        schedule.push({i:periods+1,begin:principal,principal:principal,interest:0,payment:principal,end:0});
      }else if(method==='bullet'){
        const totalInt=principal*periodRate*periods;
        for(let i=1;i<periods;i++){
          schedule.push({i,begin:principal,principal:0,interest:0,payment:0,end:principal});
        }
        schedule.push({i:periods,begin:principal,principal:principal,interest:totalInt,payment:principal+totalInt,end:0});
      }
      return schedule;
    }
    document.getElementById('calc').addEventListener('click',()=>{
      const country=document.getElementById('country').value;
      const currency=country==='jp'?'JPY':'CNY';
      const principal=parseNum(document.getElementById('principal').value);
      const rate=parseFloat(document.getElementById('rate').value)||0;
      const years=parseInt(document.getElementById('term').value)||1;
      const freq=parseInt(document.getElementById('frequency').value);
      const method=document.getElementById('method').value;
      if(principal<=0){alert('è¯·è¾“å…¥æœ‰æ•ˆçš„è´·æ¬¾é‡‘é¢');return;}
      clearTable();
      const schedule=generateSchedule({principal,annualRate:rate,years,freq,method});
      let totalPmt=0,totalInt=0;
      schedule.forEach(r=>{addRow(r.i,r.begin,r.principal,r.interest,r.payment,r.end,currency);totalPmt+=r.payment;totalInt+=r.interest;});
      document.getElementById('summary').innerHTML=`<strong>è´·æ¬¾é‡‘é¢ï¼š</strong>${fmt(principal,currency)}<br><strong>æœŸæ•°ï¼š</strong>${schedule.length} æœŸ<br><strong>æ€»è¿˜æ¬¾ï¼š</strong>${fmt(totalPmt,currency)}<br><strong>æ€»åˆ©æ¯ï¼š</strong>${fmt(totalInt,currency)}`;
      window._lastSchedule={schedule,currency};
    });
    document.getElementById('reset').addEventListener('click',()=>{
      document.getElementById('principal').value='';
      document.getElementById('rate').value='';
      document.getElementById('term').value='';
      document.getElementById('country').value='cn';
      document.getElementById('frequency').value='12';
      document.getElementById('method').value='annuity';
      document.getElementById('rateType').value='fixed';
      clearTable();
      document.getElementById('summary').textContent='è¾“å…¥è´·æ¬¾å‚æ•°åç‚¹å‡»ã€Œè®¡ç®—å¹¶ç”Ÿæˆæ‘Šè¿˜è¡¨ã€æŸ¥çœ‹ç»“æœã€‚';
      window._lastSchedule=null;
    });
    document.getElementById('exportCsv').addEventListener('click',()=>{
      if(!window._lastSchedule){alert('è¯·å…ˆè®¡ç®—æ‘Šè¿˜è¡¨');return;}
      const rows=window._lastSchedule.schedule;
      let csv='\uFEFFæœŸæ•°,æœŸåˆä½™é¢,æœ¬é‡‘,åˆ©æ¯,å½“æœŸè¿˜æ¬¾,æœŸæœ«ä½™é¢\n';
      rows.forEach(r=>{csv+=`${r.i},${r.begin},${r.principal},${r.interest},${r.payment},${r.end}\n`;});
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download=`loan_schedule_${window._lastSchedule.currency}.csv`;
      a.click();
    });
    document.getElementById('copySchedule').addEventListener('click',async()=>{
      if(!window._lastSchedule){alert('è¯·å…ˆè®¡ç®—æ‘Šè¿˜è¡¨');return;}
      const rows=window._lastSchedule.schedule,cur=window._lastSchedule.currency;
      let text='æœŸæ•°\tæœŸåˆä½™é¢\tæœ¬é‡‘\tåˆ©æ¯\tå½“æœŸè¿˜æ¬¾\tæœŸæœ«ä½™é¢\n';
      rows.forEach(r=>{text+=`${r.i}\t${fmt(r.begin,cur)}\t${fmt(r.principal,cur)}\t${fmt(r.interest,cur)}\t${fmt(r.payment,cur)}\t${fmt(r.end,cur)}\n`;});
      try{await navigator.clipboard.writeText(text);alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');}catch(e){alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·å¯¼å‡ºCSV');}
    });
  </script>
</body>
</html>
