<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>费用报销表 | 蘇的工具箱</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans SC','Hiragino Sans GB',system-ui,Arial,sans-serif;background:#f5f5f7;color:#1d1d1f;padding:16px;min-height:100vh;font-size:13px}
.container{max-width:800px;margin:0 auto;background:#fff;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08);padding:20px 24px}
h1{text-align:center;font-size:1.3rem;font-weight:600;margin-bottom:2px;letter-spacing:1px;color:#1d1d1f}
.subtitle{text-align:center;color:#86868b;font-size:0.7rem;margin-bottom:14px}
.top-bar{display:flex;justify-content:flex-end;margin-bottom:10px}
.top-bar select{padding:4px 10px;border-radius:4px;border:1px solid #d2d2d7;background:#fff;color:#1d1d1f;font-size:0.75rem;cursor:pointer}
.section{border:1px solid #e5e5e7;border-radius:6px;padding:12px;margin-bottom:12px}
.section-title{font-size:0.7rem;color:#86868b;margin-bottom:8px;font-weight:500}
.info-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.field label{display:block;font-size:0.68rem;color:#86868b;margin-bottom:2px}
.field input{width:100%;padding:6px 8px;border:1px solid #d2d2d7;border-radius:4px;background:#fafafa;color:#1d1d1f;font-size:0.8rem}
.field input:focus{outline:none;border-color:#0071e3}
table{width:100%;border-collapse:collapse;font-size:0.75rem}
th,td{border:1px solid #d2d2d7;padding:0;text-align:center}
th{background:#f5f5f7;color:#1d1d1f;font-weight:500;padding:6px 2px;font-size:0.7rem}
td{background:#fff}
td input,td select{width:100%;padding:5px 2px;border:none;background:transparent;color:#1d1d1f;text-align:center;font-size:0.75rem}
td select{cursor:pointer;appearance:none;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 4px center}
td select option{background:#fff}
td input:focus,td select:focus{outline:none;background:#f0f7ff}
td input[type="number"]{text-align:right;padding-right:6px}
.td-no{width:28px;color:#86868b;font-size:0.7rem}
.td-cat{width:80px}
.td-amt{width:85px}
.td-inv{width:90px}
.td-del{width:26px}
.btn-del{width:18px;height:18px;border:none;background:#f5f5f7;color:#86868b;border-radius:3px;cursor:pointer;font-size:0.8rem;line-height:1}
.btn-del:hover{background:#fee;color:#d70015}
.row-actions{display:flex;justify-content:center;gap:8px;margin-top:8px}
.btn-row{padding:4px 12px;border:1px dashed #d2d2d7;border-radius:4px;background:#fff;color:#86868b;font-size:0.7rem;cursor:pointer}
.btn-row:hover{border-color:#0071e3;color:#0071e3}
.summary-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.summary-item{display:flex;align-items:center;justify-content:space-between;background:#f5f5f7;border-radius:4px;padding:5px 10px}
.summary-item label{font-size:0.68rem;color:#515154}
.summary-item .val{font-size:0.8rem;color:#1d1d1f;font-weight:500}
.summary-item.total{grid-column:span 2;background:#e8f4fd;border:1px solid #c5dff6}
.summary-item.total label{color:#0055b3}
.summary-item.total .val{color:#0055b3;font-size:0.85rem;font-weight:600}
.sign-section{display:flex;justify-content:space-between;align-items:flex-end;gap:16px;margin-top:10px;padding-top:10px;border-top:1px solid #e5e5e7}
.sign-note{font-size:0.65rem;color:#86868b;line-height:1.6;flex:1}
.sign-field{display:flex;align-items:center;gap:8px;min-width:180px}
.sign-field label{font-size:0.7rem;color:#515154;white-space:nowrap}
.sign-field input{width:120px;padding:5px 0;border:none;border-bottom:1px solid #d2d2d7;background:transparent;color:#1d1d1f;font-size:0.8rem}
.sign-field input:focus{outline:none;border-bottom-color:#0071e3}
.approval-table th{background:#f5f5f7;padding:6px 2px}
.approval-table td{height:32px}
.approval-table td input{text-align:left;padding-left:6px}
.actions{display:flex;gap:8px;margin-top:14px}
.btn{padding:8px 16px;border:none;border-radius:5px;font-size:0.8rem;cursor:pointer;font-weight:500}
.btn-primary{background:#0071e3;color:#fff}
.btn-primary:hover{background:#0077ed}
.btn-secondary{background:#f5f5f7;border:1px solid #d2d2d7;color:#1d1d1f}
.btn-secondary:hover{background:#e8e8ed}
.download-wrap{position:relative}
.download-menu{position:absolute;bottom:100%;left:0;right:0;background:#fff;border:1px solid #d2d2d7;border-radius:5px;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-bottom:4px;display:none;overflow:hidden}
.download-menu.show{display:block}
.download-menu button{width:100%;padding:8px 12px;border:none;background:#fff;color:#1d1d1f;font-size:0.75rem;cursor:pointer;text-align:left}
.download-menu button:hover{background:#f5f5f7}
.download-menu button+button{border-top:1px solid #e5e5e7}
@media print{
@page{size:A4;margin:8mm 10mm}
body{background:#fff;padding:0;font-size:11px}
.container{box-shadow:none;padding:0;max-width:100%}
h1{font-size:14pt;margin-bottom:1px}
.subtitle{font-size:8pt;margin-bottom:8px}
.section{padding:8px;margin-bottom:8px;border-color:#ccc}
.section-title{font-size:8pt;margin-bottom:6px}
.info-grid{gap:8px}
.field input{padding:4px 6px;font-size:9pt}
table{font-size:9pt}
th{padding:4px 2px;font-size:8pt}
td input,td select{padding:3px 2px;font-size:9pt}
.td-no{width:22px}
.td-cat{width:70px}
.td-amt{width:75px}
.td-inv{width:80px}
.summary-grid{gap:4px}
.summary-item{padding:4px 8px}
.summary-item label{font-size:8pt}
.summary-item .val{font-size:9pt}
.sign-section{margin-top:6px;padding-top:6px}
.sign-note{font-size:7pt}
.sign-field label{font-size:8pt}
.approval-table td{height:26px}
.actions,.top-bar,.row-actions,.td-del,.btn-del{display:none!important}
}
</style>
</head>
<body>
<div class="container" id="printArea">
<div class="top-bar">
<select id="lang" onchange="switchLang()">
<option value="zh">中文</option>
<option value="jp">日本語</option>
</select>
</div>
<h1 id="title">费用报销表</h1>
<p class="subtitle" id="subtitle">蘇的工具箱 · 内部报销单据</p>

<div class="section">
<div class="info-grid">
<div class="field"><label id="l_name">员工姓名</label><input id="name"></div>
<div class="field"><label id="l_dept">部门</label><input id="dept"></div>
<div class="field"><label id="l_date">提交日期</label><input id="date" type="date"></div>
</div>
</div>

<div class="section">
<div class="section-title" id="sec_detail">费用明细</div>
<table><thead><tr>
<th class="td-no" id="th_no">序号</th>
<th class="td-cat" id="th_cat">费用类别</th>
<th id="th_desc">费用项目描述</th>
<th class="td-amt" id="th_amt">金额(円)</th>
<th class="td-inv" id="th_inv">发票编号</th>
<th class="td-del"></th>
</tr></thead><tbody id="tableBody"></tbody></table>
<div class="row-actions">
<button class="btn-row" onclick="addRow()" id="btn_add">+ 添加</button>
<button class="btn-row" onclick="delLastRow()" id="btn_del_last">− 删除末行</button>
</div>
</div>

<div class="section">
<div class="section-title" id="sec_summary">费用汇总</div>
<div class="summary-grid">
<div class="summary-item"><label id="l_trans">交通费用</label><span class="val" id="s_trans">0</span></div>
<div class="summary-item"><label id="l_meal">餐饮费用</label><span class="val" id="s_meal">0</span></div>
<div class="summary-item"><label id="l_supply">民宿用品</label><span class="val" id="s_supply">0</span></div>
<div class="summary-item"><label id="l_advance">代付费用</label><span class="val" id="s_advance">0</span></div>
<div class="summary-item"><label id="l_office">办公用品</label><span class="val" id="s_office">0</span></div>
<div class="summary-item"><label id="l_other">其他费用</label><span class="val" id="s_other">0</span></div>
<div class="summary-item total"><label id="l_total">总金额</label><span class="val" id="s_total">0 円</span></div>
</div>
<div class="sign-section">
<p class="sign-note" id="sign_note">员工确认签字，并附有所有相关票据。请确保所有费用项目均有对应发票或收据。</p>
<div class="sign-field"><label id="l_sign">员工签字</label><input id="signature"></div>
</div>
</div>

<div class="section">
<div class="section-title" id="sec_approval">审批流程</div>
<table class="approval-table"><thead><tr>
<th style="width:24%" id="th_approver">审批人姓名</th>
<th style="width:16%" id="th_position">职位</th>
<th style="width:40%" id="th_opinion">审批意见</th>
<th style="width:20%" id="th_appdate">审批日期</th>
</tr></thead><tbody>
<tr><td><input></td><td><input></td><td><input></td><td><input type="date"></td></tr>
<tr><td><input></td><td><input></td><td><input></td><td><input type="date"></td></tr>
</tbody></table>
</div>

<div class="actions">
<button class="btn btn-secondary" onclick="resetForm()" id="btn_reset">重置</button>
<button class="btn btn-secondary" onclick="window.print()" id="btn_print">打印</button>
<div class="download-wrap" style="flex:1">
<button class="btn btn-primary" style="width:100%" onclick="toggleMenu()" id="btn_download">下载 ▾</button>
<div class="download-menu" id="dlMenu">
<button onclick="downloadAs('pdf')">PDF 文档</button>
<button onclick="downloadAs('png')">PNG 图片</button>
<button onclick="downloadAs('jpg')">JPG 图片</button>
<button onclick="downloadAs('csv')">CSV 表格</button>
<button onclick="downloadAs('xlsx')">Excel 表格</button>
</div>
</div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
const CAT={zh:["","交通费用","餐饮费用","民宿用品","代付费用","办公用品","其他费用"],jp:["","交通費","飲食費","民泊用品","立替費用","事務用品","その他"]};
const MAP={zh:{交通费用:"trans",餐饮费用:"meal",民宿用品:"supply",代付费用:"advance",办公用品:"office",其他费用:"other"},jp:{交通費:"trans",飲食費:"meal",民泊用品:"supply",立替費用:"advance",事務用品:"office",その他:"other"}};
const L={zh:{title:"费用报销表",subtitle:"蘇的工具箱 · 内部报销单据",l_name:"员工姓名",l_dept:"部门",l_date:"提交日期",sec_detail:"费用明细",th_no:"序号",th_cat:"费用类别",th_desc:"费用项目描述",th_amt:"金额(円)",th_inv:"发票编号",btn_add:"+ 添加",btn_del_last:"− 删除末行",sec_summary:"费用汇总",l_trans:"交通费用",l_meal:"餐饮费用",l_supply:"民宿用品",l_advance:"代付费用",l_office:"办公用品",l_other:"其他费用",l_total:"总金额",sign_note:"员工确认签字，并附有所有相关票据。请确保所有费用项目均有对应发票或收据。",l_sign:"员工签字",sec_approval:"审批流程",th_approver:"审批人姓名",th_position:"职位",th_opinion:"审批意见",th_appdate:"审批日期",btn_reset:"重置",btn_print:"打印",btn_download:"下载 ▾"},jp:{title:"経費精算書",subtitle:"蘇のツールボックス · 社内精算書類",l_name:"氏名",l_dept:"部署",l_date:"提出日",sec_detail:"費用明細",th_no:"番号",th_cat:"費用区分",th_desc:"内容説明",th_amt:"金額(円)",th_inv:"領収書番号",btn_add:"+ 追加",btn_del_last:"− 末行削除",sec_summary:"費用集計",l_trans:"交通費",l_meal:"飲食費",l_supply:"民泊用品",l_advance:"立替費用",l_office:"事務用品",l_other:"その他",l_total:"合計",sign_note:"署名し、全ての領収書を添付してください。",l_sign:"署名",sec_approval:"承認",th_approver:"承認者",th_position:"役職",th_opinion:"意見",th_appdate:"日付",btn_reset:"リセット",btn_print:"印刷",btn_download:"保存 ▾"}};
let curLang="zh";
function switchLang(){curLang=document.getElementById("lang").value;Object.keys(L[curLang]).forEach(k=>{const el=document.getElementById(k);if(el)el.textContent=L[curLang][k];});document.querySelectorAll("td select").forEach(sel=>{const cur=sel.selectedIndex;sel.innerHTML=CAT[curLang].map(c=>`<option value="${c}">${c}</option>`).join("");sel.selectedIndex=cur;});}
function createRow(n){const tr=document.createElement("tr");tr.innerHTML=`<td class="td-no">${n}</td><td><select onchange="calcAll()">${CAT[curLang].map(c=>`<option value="${c}">${c}</option>`).join("")}</select></td><td><input></td><td><input type="number" min="0" onchange="calcAll()"></td><td><input></td><td class="td-del"><button class="btn-del" onclick="delRow(this)">×</button></td>`;return tr;}
function reindex(){document.querySelectorAll("#tableBody tr").forEach((tr,i)=>{tr.children[0].textContent=i+1;});}
function addRow(){document.getElementById("tableBody").appendChild(createRow(document.querySelectorAll("#tableBody tr").length+1));}
function delRow(btn){const tbody=document.getElementById("tableBody");if(tbody.children.length>1){btn.closest("tr").remove();reindex();calcAll();}}
function delLastRow(){const tbody=document.getElementById("tableBody");if(tbody.children.length>1){tbody.lastChild.remove();calcAll();}}
function calcAll(){const sums={trans:0,meal:0,supply:0,advance:0,office:0,other:0};const map=MAP[curLang];document.querySelectorAll("#tableBody tr").forEach(tr=>{const cat=tr.querySelector("select").value;const amt=parseFloat(tr.querySelector("input[type=number]").value)||0;if(map[cat])sums[map[cat]]+=amt;});document.getElementById("s_trans").textContent=sums.trans.toLocaleString();document.getElementById("s_meal").textContent=sums.meal.toLocaleString();document.getElementById("s_supply").textContent=sums.supply.toLocaleString();document.getElementById("s_advance").textContent=sums.advance.toLocaleString();document.getElementById("s_office").textContent=sums.office.toLocaleString();document.getElementById("s_other").textContent=sums.other.toLocaleString();document.getElementById("s_total").textContent=Object.values(sums).reduce((a,b)=>a+b,0).toLocaleString()+" 円";}
function resetForm(){document.querySelectorAll("input").forEach(inp=>inp.value="");document.querySelectorAll("select:not(#lang)").forEach(sel=>sel.selectedIndex=0);["s_trans","s_meal","s_supply","s_advance","s_office","s_other"].forEach(id=>document.getElementById(id).textContent="0");document.getElementById("s_total").textContent="0 円";}
function initTable(){for(let i=1;i<=10;i++)document.getElementById("tableBody").appendChild(createRow(i));}
function toggleMenu(){document.getElementById("dlMenu").classList.toggle("show");}
document.addEventListener("click",e=>{if(!e.target.closest(".download-wrap"))document.getElementById("dlMenu").classList.remove("show");});
function getFormData(){const rows=[];document.querySelectorAll("#tableBody tr").forEach((tr,i)=>{const cat=tr.querySelector("select").value;const desc=tr.querySelectorAll("input")[0].value;const amt=tr.querySelector("input[type=number]").value;const inv=tr.querySelectorAll("input")[2].value;if(cat||desc||amt||inv)rows.push([i+1,cat,desc,amt,inv]);});return{info:{name:document.getElementById("name").value,dept:document.getElementById("dept").value,date:document.getElementById("date").value},rows,summary:{trans:document.getElementById("s_trans").textContent,meal:document.getElementById("s_meal").textContent,supply:document.getElementById("s_supply").textContent,advance:document.getElementById("s_advance").textContent,office:document.getElementById("s_office").textContent,other:document.getElementById("s_other").textContent,total:document.getElementById("s_total").textContent}};}
async function downloadAs(type){
document.getElementById("dlMenu").classList.remove("show");
const actions=document.querySelector(".actions");
const topBar=document.querySelector(".top-bar");
const rowActions=document.querySelector(".row-actions");
const delBtns=document.querySelectorAll(".td-del");
actions.style.display="none";topBar.style.display="none";rowActions.style.display="none";delBtns.forEach(b=>b.style.display="none");
if(type==="pdf"||type==="png"||type==="jpg"){
const el=document.getElementById("printArea");
const canvas=await html2canvas(el,{backgroundColor:"#fff",scale:2});
if(type==="pdf"){
const{jsPDF}=window.jspdf;
const pdf=new jsPDF({orientation:"portrait",unit:"mm",format:"a4"});
const w=pdf.internal.pageSize.getWidth()-20;
const h=(canvas.height*w)/canvas.width;
pdf.addImage(canvas.toDataURL("image/jpeg",0.95),"JPEG",10,10,w,h);
pdf.save("expense_report.pdf");
}else{
const link=document.createElement("a");
link.download=`expense_report.${type}`;
link.href=canvas.toDataURL(type==="png"?"image/png":"image/jpeg",0.95);
link.click();
}
}else if(type==="csv"||type==="xlsx"){
const data=getFormData();
const ws_data=[["费用报销表"],[],["员工姓名",data.info.name,"部门",data.info.dept,"提交日期",data.info.date],[],["序号","费用类别","费用项目描述","金额(円)","发票编号"],...data.rows,[],["费用汇总"],["交通费用",data.summary.trans,"餐饮费用",data.summary.meal],["民宿用品",data.summary.supply,"代付费用",data.summary.advance],["办公用品",data.summary.office,"其他费用",data.summary.other],["总金额",data.summary.total]];
if(type==="csv"){
let csv="\uFEFF"+ws_data.map(r=>r.join(",")).join("\n");
const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="expense_report.csv";link.click();
}else{
const wb=XLSX.utils.book_new();
const ws=XLSX.utils.aoa_to_sheet(ws_data);
ws["!cols"]=[{wch:6},{wch:12},{wch:24},{wch:12},{wch:14}];
XLSX.utils.book_append_sheet(wb,ws,"报销表");
XLSX.writeFile(wb,"expense_report.xlsx");
}
}
actions.style.display="";topBar.style.display="";rowActions.style.display="";delBtns.forEach(b=>b.style.display="");
}
initTable();
</script>
</body>
</html>
