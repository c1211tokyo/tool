<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸œäº¬ä¸åŠ¨äº§èŠ‚ç¨æµ‹ç®— V3.0 (ä¿®å¤ç‰ˆ)</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #0f172a;
            --border: #e2e8f0;
            --accent: #f59e0b;
        }
        
        * { box-sizing: border-box; }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            padding: 20px; 
            margin: 0;
            line-height: 1.5;
        }

        .container { max-width: 1000px; margin: 0 auto; }

        /* æ ‡é¢˜åŒº */
        header { text-align: center; margin-bottom: 25px; }
        h1 { margin: 0; font-size: 1.4rem; color: var(--primary); }
        p.subtitle { margin: 5px 0 0; font-size: 0.9rem; color: #64748b; }

        /* å¸ƒå±€ */
        .grid-layout { display: grid; gap: 20px; grid-template-columns: 1fr; }
        @media(min-width: 768px) { .grid-layout { grid-template-columns: 1fr 1fr; } }

        /* å¡ç‰‡ */
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        h2 { font-size: 1rem; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; margin-top: 0; color: #334155; display: flex; align-items: center; justify-content: space-between; }
        
        /* æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
        .mode-tabs { display: flex; background: #e2e8f0; border-radius: 8px; padding: 4px; margin-bottom: 20px; }
        .tab-btn { flex: 1; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; color: #64748b; background: transparent; transition: all 0.2s; }
        .tab-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* è¡¨å• */
        .form-row { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; color: #475569; }
        .input-wrapper { position: relative; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 1rem; background: #fff; }
        input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .suffix { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-size: 0.85rem; pointer-events: none; }
        .hint { font-size: 0.75rem; color: #94a3b8; margin-top: 4px; }

        /* è‡ªåŠ¨æ¨¡å¼ä¸‹çš„é«˜äº®åŒº */
        .auto-box { background: #eff6ff; border: 1px dashed #bfdbfe; padding: 15px; border-radius: 8px; margin-top: 10px; }
        .auto-title { color: var(--primary); font-size: 0.85rem; font-weight: 700; margin-bottom: 10px; display: block; }

        /* ç»“æœå±•ç¤º */
        .result-header { background: #1e293b; color: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
        .big-number { font-size: 1.8rem; font-weight: 700; color: var(--accent); margin: 5px 0; }
        
        .ratio-bar { height: 24px; background: #e2e8f0; border-radius: 12px; overflow: hidden; display: flex; margin: 15px 0; }
        .rb-land { background: #94a3b8; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; transition: width 0.3s; }
        .rb-build { background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; transition: width 0.3s; }

        /* è¡¨æ ¼ */
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .data-table th, .data-table td { padding: 10px; text-align: right; border-bottom: 1px solid #f1f5f9; }
        .data-table th { text-align: left; color: #64748b; }
        .first-year-row { background-color: #fef9c3; font-weight: bold; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ä¸œäº¬ä¸åŠ¨äº§èŠ‚ç¨æµ‹ç®— V3.0</h1>
        <p class="subtitle">åœŸåœ°/å»ºç‰©ç²¾å‡†æ‹†åˆ† & ç®€ä¾¿æ³•æŠ˜æ—§æ¨¡æ‹Ÿ</p>
    </header>

    <div class="grid-layout">
        
        <div>
            <div class="card" style="padding: 10px;">
                <div class="mode-tabs">
                    <button id="btn-mode-manual" class="tab-btn active" onclick="switchMode('manual')">æ¨¡å¼ A: å·²çŸ¥æ‹†åˆ†ä»·</button>
                    <button id="btn-mode-auto" class="tab-btn" onclick="switchMode('auto')">æ¨¡å¼ B: æ™ºèƒ½ä¼°ç®—</button>
                </div>
                <div style="text-align:center; font-size:0.8rem; color:#64748b;">
                    <span id="mode-desc">é€‚ç”¨äºï¼šåˆåŒå·²å®šï¼Œå·²çŸ¥åœŸåœ°å’Œå»ºç­‘çš„å…·ä½“é‡‘é¢</span>
                </div>
            </div>

            <div class="card">
                <h2>1. åŸºç¡€ç¨åŠ¡è®¾å®š</h2>
                <div class="form-row">
                    <label>å»ºç­‘æ„é€  (å†³å®šè€ç”¨å¹´æ•°)</label>
                    <select id="common_structure">
                        <option value="wood">ğŸŒ² æœ¨é€  (æ³•å®š22å¹´)</option>
                        <option value="steel">ğŸ¢ è½»é’¢ (æ³•å®š27å¹´)</option>
                        <option value="rc" selected>ğŸ™ RC/SRC (æ³•å®š47å¹´)</option>
                    </select>
                </div>
                <div class="form-row">
                    <label>ç­‘å¹´æ•° (å·²ä½¿ç”¨å¹´æ•°)</label>
                    <div class="input-wrapper">
                        <input type="number" id="common_age" value="25" min="0">
                        <span class="suffix">å¹´</span>
                    </div>
                </div>
                <div class="form-row" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div>
                        <label>å…¬å¸å†³ç®—æœˆ</label>
                        <select id="common_fiscalMonth">
                            <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3" selected>3æœˆ</option>
                            <option value="4">4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                            <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                            <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                        </select>
                    </div>
                    <div>
                        <label>ä¹°å…¥/äº¤ä»˜æœˆ</label>
                        <select id="common_purchaseMonth">
                            <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3">3æœˆ</option>
                            <option value="4" selected>4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                            <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                            <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <label>æ³•äººæœ‰æ•ˆç¨ç‡</label>
                    <div class="input-wrapper">
                        <input type="number" id="common_taxRate" value="33.0" step="0.1">
                        <span class="suffix">%</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>2. ä»·æ ¼ä¸é¢ç§¯</h2>

                <div id="panel-manual">
                    <div class="form-row">
                        <label>åœŸåœ°ä»·æ ¼</label>
                        <div class="input-wrapper">
                            <input type="number" id="man_landPrice" value="5000">
                            <span class="suffix">ä¸‡å††</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <label>å»ºç‰©ä»·æ ¼ (å«æ¶ˆè´¹ç¨)</label>
                        <div class="input-wrapper">
                            <input type="number" id="man_buildPrice" value="3000">
                            <span class="suffix">ä¸‡å††</span>
                        </div>
                    </div>
                    <div class="hint" style="text-align:right;">
                        æ€»ä»·: <strong id="man_total_display">8,000</strong> ä¸‡å††
                    </div>
                </div>

                <div id="panel-auto" class="hidden">
                    <div class="form-row">
                        <label>äº¤æ˜“æ€»ä»·</label>
                        <div class="input-wrapper">
                            <input type="number" id="auto_totalPrice" value="8000">
                            <span class="suffix">ä¸‡å††</span>
                        </div>
                    </div>

                    <div class="auto-box">
                        <span class="auto-title">ğŸ“ åœŸåœ°å‚æ•° (ä¼°ç®—æƒé‡)</span>
                        <div class="form-row">
                            <label>æ‰€åœ¨åŒºåŸŸ (è‡ªåŠ¨å¡«å…¥å‚è€ƒåœ°ä»·)</label>
                            <select id="auto_ward">
                                <option value="800">æ¸¯åŒº (Minato)</option>
                                <option value="750">åƒä»£ç”°åŒº (Chiyoda)</option>
                                <option value="700">ä¸­å¤®åŒº (Chuo)</option>
                                <option value="650">æ¶©è°·åŒº (Shibuya)</option>
                                <option value="450">æ–°å®¿åŒº (Shinjuku)</option>
                                <option value="350" selected>å°ä¸œåŒº (Taito)</option>
                                <option value="300">ä¸–ç”°è°·åŒº (Setagaya)</option>
                                <option value="250">æ±Ÿä¸œåŒº (Koto)</option>
                                <option value="150">å…¶ä»–/è‡ªå®šä¹‰</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>åœŸåœ°å‚è€ƒå•ä»·</label>
                            <div class="input-wrapper">
                                <input type="number" id="auto_landUnit" value="350">
                                <span class="suffix">ä¸‡å††/åª</span>
                            </div>
                        </div>
                        <div class="form-row">
                            <label>åœŸåœ°é¢ç§¯</label>
                            <div class="input-wrapper">
                                <input type="number" id="auto_landArea" value="60">
                                <span class="suffix">ã¡</span>
                            </div>
                        </div>
                    </div>

                    <div class="auto-box">
                        <span class="auto-title">ğŸ  å»ºç‰©å‚æ•° (ä¼°ç®—æƒé‡)</span>
                        <div class="form-row">
                            <label>å»ºç‰©é¢ç§¯</label>
                            <div class="input-wrapper">
                                <input type="number" id="auto_buildArea" value="120">
                                <span class="suffix">ã¡</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div>
            <div class="result-header">
                <div style="font-size:0.9rem; opacity:0.8;">å‰ 5 å¹´ç´¯è®¡èŠ‚ç¨é¢</div>
                <div class="big-number" id="res_totalTaxSave">0 ä¸‡å††</div>
                <div style="font-size:0.85rem; margin-top:5px;">
                    é¦–å¹´æŠ˜æ—§é¢: <span id="res_year1Dep" style="color:#fbbf24; font-weight:bold;">0</span> ä¸‡å††
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“Š èµ„äº§æ‹†åˆ†è¯¦æƒ…</h2>
                
                <div class="ratio-bar">
                    <div id="bar_land" class="rb-land" style="width:50%">åœŸåœ°</div>
                    <div id="bar_build" class="rb-build" style="width:50%">å»ºç‰©</div>
                </div>

                <table class="data-table">
                    <tr>
                        <th>å»ºç‰©ä»·æ ¼ (å¯æŠ˜æ—§)</th>
                        <td style="font-weight:bold; color:var(--primary);" id="res_buildPrice">0 ä¸‡å††</td>
                    </tr>
                    <tr>
                        <th>åœŸåœ°ä»·æ ¼ (ä¸å¯æŠ˜æ—§)</th>
                        <td id="res_landPrice">0 ä¸‡å††</td>
                    </tr>
                    <tr>
                        <th>ä»·å€¼å æ¯”</th>
                        <td id="res_ratio">--</td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h2>
                    <span>ğŸ“… 5å¹´èŠ‚ç¨æ¨¡æ‹Ÿ</span>
                    <span style="font-size:0.8rem; font-weight:normal; color:#64748b;">æŠ˜æ—§æœŸ: <b id="res_depYears">0</b> å¹´</span>
                </h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="text-align:left;">å¹´åº¦</th>
                            <th>æŠ˜æ—§é¢ (æŸé‡‘)</th>
                            <th>èŠ‚ç¨ (ç°é‡‘æµ)</th>
                        </tr>
                    </thead>
                    <tbody id="schedule_body">
                        </tbody>
                </table>
                <div class="hint" style="margin-top:10px; text-align:center;">
                    * å‡è®¾å…¬å¸æœ‰è¶³å¤Ÿé»‘å­—å¯ä¾›æŠµæ‰£
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- é…ç½®ä¸å¸¸é‡ ---
    const CONFIG = {
        unitCost: { wood: 220000, steel: 280000, rc: 380000 }, // å»ºé€ æˆæœ¬ å††/m2
        life: { wood: 22, steel: 27, rc: 47 } // æ³•å®šè€ç”¨å¹´æ•°
    };

    // å½“å‰æ¨¡å¼
    let currentMode = 'manual';

    // --- 1. åˆå§‹åŒ–ä¸äº‹ä»¶ç»‘å®š ---
    document.addEventListener('DOMContentLoaded', () => {
        // ç»‘å®šæ‰€æœ‰è¾“å…¥æ¡†çš„ input äº‹ä»¶ï¼Œè§¦å‘å…¨å±€è®¡ç®—
        const allInputs = document.querySelectorAll('input, select');
        allInputs.forEach(el => {
            el.addEventListener('input', calculateAll);
            el.addEventListener('change', calculateAll);
        });

        // ç‰¹æ®Šï¼šåŒºåŸŸé€‰æ‹©æ”¹å˜æ—¶ï¼Œæ›´æ–°å•ä»·
        document.getElementById('auto_ward').addEventListener('change', function() {
            document.getElementById('auto_landUnit').value = this.value;
            calculateAll();
        });

        // åˆå§‹è®¡ç®—ä¸€æ¬¡
        calculateAll();
    });

    // --- 2. æ¨¡å¼åˆ‡æ¢ ---
    window.switchMode = function(mode) {
        currentMode = mode;
        
        // æ›´æ–°æŒ‰é’®æ ·å¼
        document.getElementById('btn-mode-manual').className = mode === 'manual' ? 'tab-btn active' : 'tab-btn';
        document.getElementById('btn-mode-auto').className = mode === 'auto' ? 'tab-btn active' : 'tab-btn';

        // åˆ‡æ¢æ˜¾ç¤ºåŒºåŸŸ
        if (mode === 'manual') {
            document.getElementById('panel-manual').classList.remove('hidden');
            document.getElementById('panel-auto').classList.add('hidden');
            document.getElementById('mode-desc').innerText = "é€‚ç”¨äºï¼šåˆåŒå·²å®šï¼Œå·²çŸ¥åœŸåœ°å’Œå»ºç­‘çš„å…·ä½“é‡‘é¢";
        } else {
            document.getElementById('panel-manual').classList.add('hidden');
            document.getElementById('panel-auto').classList.remove('hidden');
            document.getElementById('mode-desc').innerText = "é€‚ç”¨äºï¼šåªçŸ¥æ€»ä»·ï¼Œéœ€æŒ‰å¸‚åœºè¡Œæƒ…ä¼°ç®—æ‹†åˆ†æ¯”ä¾‹";
        }

        calculateAll();
    }

    // --- 3. æ ¸å¿ƒè®¡ç®—é€»è¾‘ (å•å‘æ•°æ®æµ) ---
    function calculateAll() {
        // A. è¯»å–å…¬å…±å‚æ•° (ä½¿ç”¨ safeFloat é˜²æ­¢ NaN)
        const structure = document.getElementById('common_structure').value;
        const age = safeFloat(document.getElementById('common_age').value);
        const fiscalMonth = parseInt(document.getElementById('common_fiscalMonth').value);
        const purchaseMonth = parseInt(document.getElementById('common_purchaseMonth').value);
        const taxRate = safeFloat(document.getElementById('common_taxRate').value) / 100;

        let finalLandPrice = 0;
        let finalBuildPrice = 0;

        // B. æ ¹æ®æ¨¡å¼ç¡®å®š Land/Build ä»·æ ¼
        if (currentMode === 'manual') {
            finalLandPrice = safeFloat(document.getElementById('man_landPrice').value);
            finalBuildPrice = safeFloat(document.getElementById('man_buildPrice').value);
            
            // æ›´æ–° Manual åŒºåŸŸçš„æ€»ä»·æ˜¾ç¤º
            document.getElementById('man_total_display').innerText = (finalLandPrice + finalBuildPrice).toLocaleString();

        } else {
            // è‡ªåŠ¨æ¨¡å¼ï¼šä¼°ç®—é€»è¾‘
            const totalPrice = safeFloat(document.getElementById('auto_totalPrice').value);
            const landArea = safeFloat(document.getElementById('auto_landArea').value);
            const landUnitTsubo = safeFloat(document.getElementById('auto_landUnit').value);
            const buildArea = safeFloat(document.getElementById('auto_buildArea').value);

            // 1. åœŸåœ°ä¼°å€¼: m2 -> åª -> æ€»ä»·
            const landVal = landArea * 0.3025 * landUnitTsubo; 

            // 2. å»ºç‰©ä¼°å€¼: æˆæœ¬æ³•
            const unitCost = CONFIG.unitCost[structure];
            const statLife = CONFIG.life[structure];
            const physLife = statLife * 1.5; 
            let remainRate = 1 - (age / physLife);
            if (remainRate < 0.1) remainRate = 0.1; // ä¿åº•10%
            
            const buildVal = (buildArea * unitCost * remainRate) / 10000; // æ¢ç®—ä¸ºä¸‡å††

            // 3. è®¡ç®—æƒé‡æ¯”ä¾‹
            const totalVal = landVal + buildVal;
            let buildRatio = 0;
            if (totalVal > 0) {
                buildRatio = buildVal / totalVal;
            }

            // 4. åº”ç”¨åˆ°æ€»ä»·
            finalBuildPrice = totalPrice * buildRatio;
            finalLandPrice = totalPrice * (1 - buildRatio);
        }

        // C. æ›´æ–°ç»“æœæ˜¾ç¤º (æ‹†åˆ†éƒ¨åˆ†)
        updateSplitResult(finalLandPrice, finalBuildPrice);

        // D. è®¡ç®—æŠ˜æ—§è¡¨
        calculateDepreciation(finalBuildPrice, structure, age, fiscalMonth, purchaseMonth, taxRate);
    }

    function updateSplitResult(land, build) {
        const total = land + build;
        const landPct = total > 0 ? (land / total * 100) : 0;
        const buildPct = total > 0 ? (build / total * 100) : 0;

        document.getElementById('res_landPrice').innerText = Math.round(land).toLocaleString() + " ä¸‡å††";
        document.getElementById('res_buildPrice').innerText = Math.round(build).toLocaleString() + " ä¸‡å††";
        document.getElementById('res_ratio').innerText = `åœŸåœ° ${landPct.toFixed(1)}% : å»ºç‰© ${buildPct.toFixed(1)}%`;

        document.getElementById('bar_land').style.width = landPct + "%";
        document.getElementById('bar_land').innerText = landPct > 10 ? `åœŸåœ° ${Math.round(landPct)}%` : "";
        
        document.getElementById('bar_build').style.width = buildPct + "%";
        document.getElementById('bar_build').innerText = buildPct > 10 ? `å»ºç‰© ${Math.round(buildPct)}%` : "";
    }

    function calculateDepreciation(price, structure, age, fiscalMonth, purchaseMonth, taxRate) {
        if (price <= 0) {
            clearTable();
            return;
        }

        // 1. ç¡®å®šè€ç”¨å¹´æ•° (ç®€ä¾¿æ³•)
        const statLife = CONFIG.life[structure];
        let depYears;
        if (age >= statLife) {
            depYears = Math.floor(statLife * 0.2);
        } else {
            depYears = Math.floor((statLife - age) + (age * 0.2));
        }
        if (depYears < 2) depYears = 2;

        document.getElementById('res_depYears').innerText = depYears;

        // 2. è®¡ç®—ç¬¬ä¸€å¹´æŠ˜æ—§æœˆæ•°
        let monthsYear1 = 0;
        if (purchaseMonth <= fiscalMonth) {
            // åŒå¹´ (ä¹°:1æœˆ, å†³:3æœˆ -> 3ä¸ªæœˆ)
            monthsYear1 = fiscalMonth - purchaseMonth + 1;
        } else {
            // è·¨å¹´ (ä¹°:4æœˆ, å†³:3æœˆ -> 4~12(9) + 1~3(3) = 12ä¸ªæœˆ)
            monthsYear1 = (12 - purchaseMonth + 1) + fiscalMonth;
        }

        // 3. ç”Ÿæˆè¡¨æ•°æ®
        let html = "";
        let totalTaxSave = 0;
        let year1Dep = 0;
        const annualDep = price / depYears; // æ»¡é¢å¹´æŠ˜æ—§

        // ç®€å•æ¨¡æ‹Ÿ5å¹´
        for (let i = 1; i <= 5; i++) {
            let currentDep = 0;
            
            if (i === 1) {
                // ç¬¬ä¸€å¹´æŒ‰æœˆ
                currentDep = annualDep * (monthsYear1 / 12);
                year1Dep = currentDep;
            } else if (i <= depYears) {
                // ä¸­é—´å¹´ä»½æ»¡é¢
                currentDep = annualDep;
            } else if (i === depYears + 1) {
                // è¡¥é½å‰©ä½™ (éå¸¸ç²—ç•¥çš„æ¨¡æ‹Ÿ)
                // å¦‚æœ depYears = 2ï¼Œç¬¬ä¸€å¹´0.5ï¼Œç¬¬äºŒå¹´1ï¼Œç¬¬ä¸‰å¹´0.5
                const usedMonths = monthsYear1 + (i-2)*12;
                const totalMonths = depYears * 12;
                if (usedMonths < totalMonths) {
                    let remain = totalMonths - usedMonths;
                    if (remain > 12) remain = 12;
                    currentDep = annualDep * (remain / 12);
                }
            }

            // ä¿®æ­£ï¼šå¦‚æœç´¯è®¡æŠ˜æ—§è¶…è¿‡æˆ¿ä»· (é˜²æ­¢æº¢å‡º)
            // æœ¬å·¥å…·ä¸ºç®€æ˜“ç‰ˆï¼Œæš‚ä¸å¼•å…¥å¤æ‚çš„è´¦é¢ä»·å€¼è¿½è¸ªå˜é‡ï¼Œä»…ä¾é ä¸Šè¿°é€»è¾‘

            const taxSave = currentDep * taxRate;
            totalTaxSave += taxSave;

            html += `
                <tr class="${i===1 ? 'first-year-row' : ''}">
                    <td>ç¬¬ ${i} å¹´</td>
                    <td>${Math.round(currentDep).toLocaleString()} ä¸‡</td>
                    <td style="color:${taxSave>0 ? '#10b981' : 'inherit'}">+${Math.round(taxSave).toLocaleString()} ä¸‡</td>
                </tr>
            `;
        }

        document.getElementById('schedule_body').innerHTML = html;
        document.getElementById('res_totalTaxSave').innerText = Math.round(totalTaxSave).toLocaleString() + " ä¸‡å††";
        document.getElementById('res_year1Dep').innerText = Math.round(year1Dep).toLocaleString();
    }

    // --- è¾…åŠ©ï¼šå®‰å…¨è§£ææµ®ç‚¹æ•° ---
    function safeFloat(val) {
        const f = parseFloat(val);
        return isNaN(f) ? 0 : f;
    }

    function clearTable() {
        document.getElementById('schedule_body').innerHTML = "<tr><td colspan='3' style='text-align:center'>è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢</td></tr>";
        document.getElementById('res_totalTaxSave').innerText = "0 ä¸‡å††";
        document.getElementById('res_year1Dep').innerText = "0";
    }

</script>

</body>
</html>
