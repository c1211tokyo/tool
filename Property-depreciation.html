<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸œäº¬ä¸åŠ¨äº§èŠ‚ç¨æµ‹ç®—å·¥å…· V2.0 (Pro)</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
            --accent: #f59e0b;
        }

        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.5; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* å¸ƒå±€ */
        .grid-main { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media(min-width: 900px) { .grid-main { grid-template-columns: 400px 1fr; } }

        .card { background: var(--card); padding: 24px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        h2 { font-size: 1.1rem; border-bottom: 2px solid var(--bg); padding-bottom: 10px; margin-top: 0; color: var(--primary); }
        
        /* æ¨¡å¼åˆ‡æ¢ Tabs */
        .tabs { display: flex; background: #e2e8f0; border-radius: 8px; padding: 4px; margin-bottom: 20px; }
        .tab-btn { flex: 1; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; color: #64748b; background: transparent; transition: 0.2s; }
        .tab-btn.active { background: white; color: var(--primary); shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* è¡¨å•å…ƒç´  */
        .form-group { margin-bottom: 14px; }
        label { display: block; font-size: 0.85rem; font-weight: 500; margin-bottom: 6px; }
        .input-group { position: relative; display: flex; align-items: center; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 0.95rem; }
        .unit { position: absolute; right: 10px; color: #94a3b8; font-size: 0.85rem; pointer-events: none; }
        .helper { font-size: 0.75rem; color: #64748b; margin-top: 4px; }

        /* è‡ªåŠ¨ä¼°ç®—åŒºåŸŸèƒŒæ™¯è‰² */
        .auto-mode-bg { background-color: #f0f9ff; border: 1px dashed var(--primary); padding: 15px; border-radius: 8px; margin-bottom: 15px; }

        /* ç»“æœå±•ç¤º */
        .summary-box { background: #1e293b; color: white; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px; }
        .summary-val { font-size: 2rem; font-weight: 700; color: var(--accent); }
        .summary-sub { font-size: 0.9rem; opacity: 0.8; }

        /* è¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th, td { padding: 10px; text-align: right; border-bottom: 1px solid var(--border); }
        th { text-align: left; color: #64748b; font-weight: 500; }
        tr:last-child td { border-bottom: none; }
        .highlight-row { background-color: #fef3c7; font-weight: bold; }

        /* éšè—ç±» */
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align:center; margin-bottom:20px;">
        <h1 style="margin:0;">ä¸œäº¬ä¸åŠ¨äº§èŠ‚ç¨æµ‹ç®—å·¥å…· V2.0</h1>
        <p style="margin:5px 0; color:#64748b;">æ”¯æŒï¼šæ‰‹åŠ¨æ‹†åˆ†å½•å…¥ / æ™ºèƒ½ä¼°ç®— / é¦–å¹´æœˆå‰²è®¡ç®—</p>
    </div>

    <div class="grid-main">
        
        <div>
            <div class="card" style="padding: 10px;">
                <div class="tabs">
                    <button class="tab-btn active" onclick="setMode('manual')">æ¨¡å¼ A: å·²çŸ¥æ‹†åˆ†ä»·</button>
                    <button class="tab-btn" onclick="setMode('auto')">æ¨¡å¼ B: æ™ºèƒ½ä¼°ç®—</button>
                </div>
            </div>

            <div class="card">
                <h2>1. åŸºç¡€ä¿¡æ¯ (ç¨åŠ¡è®¾å®š)</h2>
                <div class="form-group">
                    <label>å»ºç­‘æ„é€  (å†³å®šè€ç”¨å¹´æ•°)</label>
                    <select id="structure" onchange="calc()">
                        <option value="wood">ğŸŒ² æœ¨é€  (æ³•å®š22å¹´)</option>
                        <option value="steel">ğŸ¢ è½»é’¢ (æ³•å®š27å¹´)</option>
                        <option value="rc" selected>ğŸ™ RC/SRC (æ³•å®š47å¹´)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ç­‘å¹´æ•° (å·²ä½¿ç”¨å¹´æ•°)</label>
                    <div class="input-group">
                        <input type="number" id="age" value="25" oninput="calc()">
                        <span class="unit">å¹´</span>
                    </div>
                </div>
                <div class="form-group" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div>
                        <label>å…¬å¸å†³ç®—æœˆ</label>
                        <select id="fiscalMonth" onchange="calc()">
                            <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3" selected>3æœˆ</option>
                            <option value="4">4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                            <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                            <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                        </select>
                    </div>
                    <div>
                        <label>ä¹°å…¥/äº¤ä»˜æœˆ</label>
                        <select id="purchaseMonth" onchange="calc()">
                            <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3">3æœˆ</option>
                            <option value="4" selected>4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                            <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                            <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                        </select>
                    </div>
                </div>
                <div class="helper">âš ï¸ å½±å“ç¬¬ä¸€å¹´æŒ‰æœˆè®¡ç®—çš„æŠ˜æ—§é¢</div>
                <br>
                <div class="form-group">
                    <label>é€‚ç”¨ç¨ç‡ (æ³•äººç¨ç­‰åˆè®¡)</label>
                    <div class="input-group">
                        <input type="number" id="taxRate" value="33.0" step="0.1" oninput="calc()">
                        <span class="unit">%</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 id="inputTitle">2. ä»·æ ¼ä¸é¢ç§¯</h2>
                
                <div id="mode-manual">
                    <div class="form-group">
                        <label>å»ºç‰©ä»·æ ¼ (å«ç¨/å»ºè®®å€¼)</label>
                        <div class="input-group">
                            <input type="number" id="man_buildPrice" value="3000" oninput="calc()">
                            <span class="unit">ä¸‡å††</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>åœŸåœ°ä»·æ ¼</label>
                        <div class="input-group">
                            <input type="number" id="man_landPrice" value="5000" oninput="calc()">
                            <span class="unit">ä¸‡å††</span>
                        </div>
                    </div>
                    <div class="helper" style="text-align:right;">æ€»ä»·: <span id="man_total">8000</span> ä¸‡å††</div>
                </div>

                <div id="mode-auto" class="hidden">
                    <div class="form-group">
                        <label>ç‰©ä»¶æ€»ä»· (äº¤æ˜“æ€»é¢)</label>
                        <div class="input-group">
                            <input type="number" id="auto_totalPrice" value="8000" oninput="autoEstimate()">
                            <span class="unit">ä¸‡å††</span>
                        </div>
                    </div>
                    
                    <div class="auto-mode-bg">
                        <label style="color:var(--primary); margin-bottom:10px; display:block;">ğŸ”¹ åœŸåœ°ä¼°å€¼å‚æ•°</label>
                        <div class="form-group">
                            <label>æ‰€åœ¨åŒºåŸŸ (è‡ªåŠ¨è°ƒå–å¹³å‡åœ°ä»·)</label>
                            <select id="wardSelect" onchange="updateWardBasePrice()">
                                <option value="minato">æ¸¯åŒº (Minato)</option>
                                <option value="chiyoda">åƒä»£ç”°åŒº (Chiyoda)</option>
                                <option value="chuo">ä¸­å¤®åŒº (Chuo)</option>
                                <option value="shibuya">æ¶©è°·åŒº (Shibuya)</option>
                                <option value="shinjuku">æ–°å®¿åŒº (Shinjuku)</option>
                                <option value="meguro">ç›®é»‘åŒº (Meguro)</option>
                                <option value="setagaya">ä¸–ç”°è°·åŒº (Setagaya)</option>
                                <option value="koto">æ±Ÿä¸œåŒº (Koto)</option>
                                <option value="taito" selected>å°ä¸œåŒº (Taito)</option>
                                <option value="other">å…¶ä»–/è‡ªå®šä¹‰</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>åœŸåœ°é¢ç§¯</label>
                            <div class="input-group">
                                <input type="number" id="auto_landArea" value="60" oninput="autoEstimate()">
                                <span class="unit">ã¡</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>å‚è€ƒåœ°ä»· (å¯æ‰‹åŠ¨ä¿®æ­£)</label>
                            <div class="input-group">
                                <input type="number" id="auto_landUnitPrice" value="150" oninput="autoEstimate()">
                                <span class="unit">ä¸‡å††/åª</span>
                            </div>
                            <div class="helper">ç³»ç»Ÿæ ¹æ®æ‰€é€‰åŒºè‡ªåŠ¨é¢„å¡«ï¼Œå¯æ ¹æ®è·¯çº¿ä»·æ‰‹åŠ¨ä¿®æ”¹ã€‚</div>
                        </div>
                    </div>

                    <div class="auto-mode-bg">
                        <label style="color:var(--primary); margin-bottom:10px; display:block;">ğŸ”¹ å»ºç‰©ä¼°å€¼å‚æ•°</label>
                        <div class="form-group">
                            <label>å»ºç‰©é¢ç§¯</label>
                            <div class="input-group">
                                <input type="number" id="auto_buildArea" value="120" oninput="autoEstimate()">
                                <span class="unit">ã¡</span>
                            </div>
                        </div>
                        <div style="font-size:0.85rem; color:#64748b; margin-top:5px;">
                            ä¼°ç®—ç»“æœï¼šåœŸåœ° <span id="est_land_val">--</span> + å»ºç‰© <span id="est_build_val">--</span>
                            <br>
                            <span style="color:var(--accent)">å°†æŒ‰æ­¤æ¯”ä¾‹æ‹†åˆ†æ€»ä»·</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <div class="summary-box">
                <div class="summary-sub">å‰5å¹´ç´¯è®¡èŠ‚ç¨ (æ³•äººç¨)</div>
                <div class="summary-val" id="res_totalTaxSave">---</div>
                <div style="margin-top:10px; font-size:0.9rem;">
                    é¦–å¹´æŠ˜æ—§é¢: <span id="res_year1_dep" style="color:#fbbf24">---</span>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“Š æ‹†åˆ†ç»“æœ</h2>
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>å»ºç‰©ä»·æ ¼ (å¯æŠ˜æ—§åŸºæ•°)</span>
                    <span style="font-weight:bold; font-size:1.1rem;" id="res_finalBuildPrice">---</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>åœŸåœ°ä»·æ ¼ (ä¸å¯æŠ˜æ—§)</span>
                    <span style="font-weight:bold; font-size:1.1rem;" id="res_finalLandPrice">---</span>
                </div>
                <div style="display:flex; justify-content:space-between; color:#64748b; font-size:0.9rem;">
                    <span>åœŸåœ°/å»ºç‰© æ¯”ä¾‹</span>
                    <span id="res_ratio">---</span>
                </div>
                <div style="height:10px; background:#e2e8f0; border-radius:5px; margin-top:10px; overflow:hidden; display:flex;">
                    <div id="bar_land" style="background:#94a3b8; width:50%"></div>
                    <div id="bar_build" style="background:var(--primary); width:50%"></div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“… 5å¹´èŠ‚ç¨æ¨¡æ‹Ÿ (Cashflow)</h2>
                <div class="helper" style="margin-bottom:10px;">
                    æŠ˜æ—§å¹´æ•°: <strong id="res_depYears">--</strong> å¹´ (ç®€ä¾¿æ³•)
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>å¹´åº¦</th>
                            <th>æŠ˜æ—§é¢ (æŸé‡‘)</th>
                            <th>èŠ‚ç¨é¢ (ç°é‡‘æµ)</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTable">
                        </tbody>
                </table>
            </div>
            
            <div style="font-size:0.8rem; color:#94a3b8; text-align:center; margin-top:20px;">
                æ³¨ï¼šé¦–å¹´æŒ‰æœˆå‰²è®¡ç®—ï¼ˆåŒ…å«è´­ä¹°æœˆï¼‰ã€‚å‡è®¾å…¬å¸é»‘å­—ï¼Œç¨é‡‘èƒ½å®Œå…¨æŠµæ‰£ã€‚
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. åŸºç¡€æ•°æ® (2024å¹´ä¸œäº¬å¤§è‡´è¡Œæƒ… - ä¸‡å††/åª) ---
    // ä¸ºäº†ç®€åŒ–ï¼Œè¿™é‡Œç”¨â€œåªå•ä»·â€ä½œä¸ºåŸºå‡†ï¼Œå› ä¸ºæ—¥æœ¬äººä¹ æƒ¯ç”¨åª
    const WARD_DATA = {
        'minato': 800,    // æ¸¯åŒº
        'chiyoda': 750,   // åƒä»£ç”°
        'chuo': 700,      // ä¸­å¤®
        'shibuya': 650,   // æ¶©è°·
        'shinjuku': 450,  // æ–°å®¿
        'meguro': 400,    // ç›®é»‘
        'setagaya': 300,  // ä¸–ç”°è°·
        'koto': 250,      // æ±Ÿä¸œ
        'taito': 350,     // å°ä¸œ
        'other': 150      // å…¶ä»–é»˜è®¤
    };

    // å»ºç­‘å•ä»· (å††/m2) - 2024 å‚è€ƒ
    const BUILD_UNIT_COST = {
        'wood': 220000,
        'steel': 280000,
        'rc': 380000
    };

    const LIFE_YEARS = {
        'wood': 22,
        'steel': 27,
        'rc': 47
    };

    // å½“å‰æ¨¡å¼
    let currentMode = 'manual';
